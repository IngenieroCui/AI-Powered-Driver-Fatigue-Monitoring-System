# üöó AI-Powered Driver Fatigue Monitoring System  
*Sistema Inteligente de Monitoreo de Fatiga del Conductor ‚Äì Classic vs IA*

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![OpenCV](https://img.shields.io/badge/OpenCV-4.x-green.svg)](https://opencv.org/)

---

## üåê Language / Idioma
- [üá∫üá∏ English](#english-version)
- [üá™üá∏ Espa√±ol](#versi√≥n-en-espa√±ol)

---

# üá∫üá∏ English Version

## üìã Project Overview
This project implements a **driver fatigue monitoring system** with two complementary approaches:

1. **Classic (rule-based) approach** ‚Äì Uses handcrafted features and thresholds:
	 - Eye Aspect Ratio (EAR) for eye closure
	 - Mouth Aspect Ratio (MAR) for yawns
	 - Head pose tilt estimation
2. **AI (deep learning) approach** ‚Äì Uses convolutional neural networks (CNNs):
	 - Eye CNN ‚Üí probability of *eyes closed*
	 - Yawn CNN ‚Üí probability of *yawn*
	 - Drowsy CNN ‚Üí probability of *global drowsiness* using the full face

The goal is to **compare the classic vs AI approach** in terms of behavior and detection quality, using the same camera input.

## üéØ Objectives
- Build a real-time fatigue detection system focused on drivers.
- Provide a **classic baseline** and an **AI-based alternative**.
- Enable side-by-side experiments and analysis (classic vs AI).

## ‚ú® Main Features
- Real-time face and landmark detection using MediaPipe Face Mesh.
- Classic metrics:
	- EAR, MAR and head tilt calculation.
	- Rule-based fatigue detection and CSV logging.
- AI models:
	- Eye, yawn and drowsy classifiers based on MobileNet.
	- Probability bars overlay (eyes closed, yawning, drowsy).
- Webcam-based demo, designed for driver scenario (front-facing camera).

## üóÇ Project Structure (simplified)
```text
.
‚îú‚îÄ‚îÄ main.py              # Classic fatigue detector (rule-based)
‚îú‚îÄ‚îÄ ai_main.py           # AI-based fatigue detector (CNNs)
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ cew/             # Closed Eyes in the Wild dataset
‚îÇ   ‚îú‚îÄ‚îÄ fyp/             # Additional eye dataset
‚îÇ   ‚îú‚îÄ‚îÄ yawdd/           # YawDD driver drowsiness dataset
‚îÇ   ‚îî‚îÄ‚îÄ drowsy/          # Processed dataset for drowsy CNN
‚îî‚îÄ‚îÄ src/
		‚îú‚îÄ‚îÄ classic/
		‚îÇ   ‚îú‚îÄ‚îÄ config.py
		‚îÇ   ‚îú‚îÄ‚îÄ detector.py     # FatigueDetector class (classic)
		‚îÇ   ‚îú‚îÄ‚îÄ ear_mar.py
		‚îÇ   ‚îú‚îÄ‚îÄ head_pose.py
		‚îÇ   ‚îî‚îÄ‚îÄ utils.py
		‚îú‚îÄ‚îÄ ai/
		‚îÇ   ‚îú‚îÄ‚îÄ infer_eye.py
		‚îÇ   ‚îú‚îÄ‚îÄ infer_yawn.py
		‚îÇ   ‚îú‚îÄ‚îÄ infer_drowsy.py
		‚îÇ   ‚îú‚îÄ‚îÄ preprocess_cew.py
		‚îÇ   ‚îú‚îÄ‚îÄ preprocess_fyp.py
		‚îÇ   ‚îú‚îÄ‚îÄ preprocess_yawdd_yawn.py
		‚îÇ   ‚îú‚îÄ‚îÄ preprocess_drowsy.py
		‚îÇ   ‚îú‚îÄ‚îÄ train_eye.py
		‚îÇ   ‚îú‚îÄ‚îÄ train_yawn.py
		‚îÇ   ‚îî‚îÄ‚îÄ train_drowsy.py
		‚îî‚îÄ‚îÄ models/
				‚îî‚îÄ‚îÄ mobilenet_fatigue.py
```

> Note: dataset folders are not included in the repository; you must place them under `data/` as described above.

## üõ†Ô∏è Technologies Used
- **Language:** Python 3.8+
- **Computer vision:** OpenCV, MediaPipe
- **Deep learning:** PyTorch, Torchvision (MobileNet-based models)
- **Numerical tools:** NumPy, pandas

---

## üì¶ Installation

### 1. Create and activate a virtual environment (recommended)
```bash
python -m venv .venv

# Windows
.venv\Scripts\activate
```

### 2. Install dependencies
```bash
pip install -r requirements.txt
```

> On some systems you may want to install a specific build of `torch` (CPU or GPU) following the official PyTorch instructions.

### 3. Prepare datasets (optional, for training)
- Place original datasets under `data/` (YAWDD, CEW, FYP, etc.).
- Run the preprocessing scripts in `src/ai/` to generate processed datasets:
	- `preprocess_cew.py`, `preprocess_fyp.py`, `preprocess_yawdd_yawn.py`, `preprocess_drowsy.py`.
- Train models (if you don't already have `.pt` files in `models/`):
	- `train_eye.py`, `train_yawn.py`, `train_drowsy.py`.

For simply **running the demos**, you only need the trained model files:

- `models/eye_cnn.pt`
- `models/yawn_cnn.pt`
- `models/drowsy_cnn.pt`

---

## üöÄ Usage

### 1. Classic mode (rule-based)
Runs the classic fatigue detector based on EAR, MAR and head pose.

```bash
python main.py
```

This will open a window with the webcam feed and overlay:
- EAR/MAR values
- head tilt information
- textual alerts when fatigue patterns are detected.

### 2. AI mode (CNN-based)
Runs the AI-based detector using the three CNN models (eyes, yawn, drowsy).

```bash
python ai_main.py
```

The window shows probability bars for:
- **Eyes Closed** (Eye CNN)
- **Yawning** (Yawn CNN)
- **Drowsy** (Global drowsiness CNN)

Press `q` to exit in both modes.

### 3. Classic vs AI comparison
- Run `main.py` to observe classic, rule-based decisions.
- Run `ai_main.py` to observe AI probabilities.

You can compare:
- When classic raises an alert vs when AI probabilities are high.
- Sensitivity to brief events (short eye closure, quick yawns).

---

# üá™üá∏ Versi√≥n en Espa√±ol

## üìã Resumen del Proyecto
Este proyecto implementa un **sistema de monitoreo de fatiga del conductor** con dos enfoques complementarios:

1. **Enfoque cl√°sico (basado en reglas)** ‚Äì Usa caracter√≠sticas manuales e umbrales:
	 - Eye Aspect Ratio (EAR) para cierre de ojos.
	 - Mouth Aspect Ratio (MAR) para bostezos.
	 - Inclinaci√≥n de la cabeza (head tilt).
2. **Enfoque IA (deep learning)** ‚Äì Usa redes neuronales convolucionales (CNN):
	 - CNN de ojos ‚Üí probabilidad de *ojos cerrados*.
	 - CNN de bostezo ‚Üí probabilidad de *bostezo*.
	 - CNN de somnolencia ‚Üí probabilidad de *somnolencia global* usando el rostro completo.

El objetivo es **comparar el enfoque cl√°sico vs IA**, utilizando la misma c√°mara y condiciones.

## üéØ Objetivos
- Construir un sistema de detecci√≥n de fatiga en tiempo real enfocado en conductores.
- Proveer una l√≠nea base cl√°sica y una alternativa basada en IA.
- Permitir experimentos y an√°lisis comparativos (classic vs IA).

## ‚ú® Caracter√≠sticas Principales
- Detecci√≥n de rostro y landmarks en tiempo real con MediaPipe Face Mesh.
- M√©tricas cl√°sicas:
	- C√°lculo de EAR, MAR e inclinaci√≥n de la cabeza.
	- Detecci√≥n de fatiga mediante reglas y registro en CSV.
- Modelos de IA:
	- Clasificador de ojos, bostezo y somnolencia (MobileNet).
	- Barras de probabilidad en pantalla.
- Demo con c√°mara web, pensada para escenarios de conducci√≥n.

## üì¶ Instalaci√≥n

### 1. Crear y activar entorno virtual (recomendado)
```bash
python -m venv .venv

# Windows
.venv\Scripts\activate
```

### 2. Instalar dependencias
```bash
pip install -r requirements.txt
```

### 3. Preparar datasets (opcional, para entrenamiento)
- Coloca los datasets originales dentro de `data/`.
- Ejecuta los scripts de preprocesado en `src/ai/`.
- Entrena los modelos si no tienes los archivos `.pt` en `models/`.

Para **solo ejecutar las demos**, basta con contar con los modelos entrenados:

- `models/eye_cnn.pt`
- `models/yawn_cnn.pt`
- `models/drowsy_cnn.pt`

## üöÄ Uso

### 1. Modo cl√°sico (reglas)
Inicia el detector cl√°sico basado en EAR, MAR y pose de la cabeza:

```bash
python main.py
```

Ver√°s en pantalla:
- Valores de EAR/MAR.
- Informaci√≥n de inclinaci√≥n de cabeza.
- Mensajes de alerta cuando se detectan patrones de fatiga.

### 2. Modo IA (redes neuronales)
Inicia el detector basado en IA con los tres modelos CNN:

```bash
python ai_main.py
```

En la ventana se mostrar√°n barras de probabilidad para:
- **Eyes Closed** (ojos cerrados).
- **Yawning** (bostezo).
- **Drowsy** (somnolencia).

Pulsa `q` para salir en ambos modos.

### 3. Comparaci√≥n Classic vs IA
- Ejecuta `main.py` para ver el comportamiento cl√°sico.
- Ejecuta `ai_main.py` para ver el comportamiento IA.

Puedes comparar:
- Cu√°ndo el cl√°sico lanza una alerta frente a cu√°ndo las probabilidades de IA son altas.
- Sensibilidad a eventos cortos (cierres breves de ojos, bostezos r√°pidos).

---

## üë• Autores
- **Juan David Reyes Cure**
- **Juan Esteban Monroy Castellanos**
- **Camilo Novoa Montenegro**

---

## ‚ö†Ô∏è Limitaciones y Consideraciones
- El rendimiento puede verse afectado por:
	- Condiciones de iluminaci√≥n pobres.
	- Calidad de la c√°mara.
	- Obstrucciones parciales del rostro (gafas, manos, etc.).
- Los modelos de IA han sido entrenados con datasets espec√≠ficos y pueden requerir reajuste para otros contextos.

Este proyecto est√° orientado a fines acad√©micos y de investigaci√≥n, y **no debe utilizarse como √∫nico sistema de seguridad en veh√≠culos reales**.

---

*Last updated / √öltima actualizaci√≥n: November 2025*

